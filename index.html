<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade Report - Professional Issues</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- XLSX Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Add your styles here */
    body {
      background-color: #f4f6f8;
      font-family: 'Arial', sans-serif;
    }
    .container {
      max-width: 1200px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    h1, h3 {
      color: #2c3e50;
      text-align: center;
    }
    .table {
      margin-top: 20px;
      width: 100%;
      border-collapse: collapse;
    }
    .table thead {
      background-color: #007bff;
      color: #fff;
    }
    .table th, .table td {
      text-align: center;
      padding: 10px;
      border: 1px solid #ddd;
    }
    .table tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .table tbody tr:hover {
      background-color: #f1f1f1;
    }
    .search-bar {
      margin-bottom: 20px;
    }
    #chart-container {
      margin-top: 40px;
      max-width: 800px;
      margin: auto;
    }
  </style>
  
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">Grade Report for BSIT 3.1 B</h1>
    <h3 class="text-center mb-5">Subject: Professional Issues</h3>

    <!-- Search Bar -->
    <div class="search-bar">
      <input type="text" id="searchInput" class="form-control" placeholder="Search by Student Number or Name">
    </div>

    <!-- Grade Report Table -->
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Student Number</th>
          <th>Student Name</th>
          <th>06TP1</th>
          <th>05Act1</th>
          <th>05Assign</th>
          <th>05Quiz1</th>
          <th>06GrpAct1</th>
          <th>Q1</th>
          <th>Q2</th>
          <th>Q3</th>
          <th>Q4</th>
          <th>EX</th>
        </tr>
      </thead>
      <tbody id="studentTableBody">
        <!-- Table rows will be dynamically populated -->
      </tbody>
    </table>

    <!-- Chart -->
    <div id="chart-container" style="max-width: 800px; margin: auto;">
      <canvas id="gradesChart"></canvas>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    const EXCEL_FILE_URL = "https://raw.githubusercontent.com/<YOUR_GITHUB_USERNAME>/<REPO_NAME>/main/GradeData.xlsx";

    let studentData = [];

    // Fetch Excel file from GitHub and process it
    async function fetchExcelFile() {
      const response = await fetch(EXCEL_FILE_URL);
      if (!response.ok) {
        console.error("Failed to fetch Excel file.");
        return;
      }
      const arrayBuffer = await response.arrayBuffer();
      const workbook = XLSX.read(new Uint8Array(arrayBuffer), { type: "array" });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
      studentData = processTableData(jsonData);
      populateTable(studentData);
      renderChart(studentData);
    }

    function processTableData(data) {
      return data.slice(1).map(row => ({
        studentNumber: row[0] || "",
        studentName: row[1] || "",
        tp1: row[2],
        act1: row[3],
        assign: row[4],
        quiz1: row[5],
        grpAct1: row[6],
        q1: row[7],
        q2: row[8],
        q3: row[9],
        q4: row[10],
        exam: row[11],
      }));
    }

    function populateTable(data) {
      const tableBody = document.getElementById("studentTableBody");
      tableBody.innerHTML = data.map(student => `
        <tr>
          <td>${student.studentNumber}</td>
          <td>${student.studentName}</td>
          <td>${student.tp1 || "-"}</td>
          <td>${student.act1 || "-"}</td>
          <td>${student.assign || "-"}</td>
          <td>${student.quiz1 || "-"}</td>
          <td>${student.grpAct1 || "-"}</td>
          <td>${student.q1 || "-"}</td>
          <td>${student.q2 || "-"}</td>
          <td>${student.q3 || "-"}</td>
          <td>${student.q4 || "-"}</td>
          <td>${student.exam || "-"}</td>
        </tr>
      `).join("");
    }

    function renderChart(data) {
      const ctx = document.getElementById("gradesChart").getContext("2d");
      const chartData = data.map(student => student.exam || 0);
      const labels = data.map(student => student.studentName);
      new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Exam Scores",
            data: chartData,
            backgroundColor: "rgba(75, 192, 192, 0.2)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1,
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true },
          },
        }
      });
    }

    document.getElementById("searchInput").addEventListener("input", function(event) {
      const searchValue = event.target.value.toLowerCase();
      const filteredData = studentData.filter(student =>
        student.studentNumber.toLowerCase().includes(searchValue) ||
        student.studentName.toLowerCase().includes(searchValue)
      );
      populateTable(filteredData);
    });

    fetchExcelFile(); // Initial fetch of data from GitHub
  </script>
</body>
</html>
